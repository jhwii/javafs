<!doctype html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">
<head>
    <meta charset="UTF-8">
    <title>결제하기</title>
    <script src="https://js.tosspayments.com/v1/payment"></script>
</head>

<!-- Start Contact Area -->
<section id="contact-us" class="contact-us section">
    <div class="container">
        <div class="contact-inner-title">
            <h2>결제 정보</h2>
            <span>
                <span>orderNumber:</span>
                <span id="orderId">post-p</span>
            </span><br>
            <span>
                <span>orderName:</span>
                <span id="orderName">포르쉐</span>
            </span><br>
            <span>
                <span>customerName:</span>
                <span id="customerName">위재형</span>
            </span>
        </div>

        <div class="contact-inner-title">
            <span>amount:</span>
            <span id="amount">[[${car.price}]]원</span>
        </div>

        <div class="d-grid gap-2 m-t-20">
            <button id="payment_card_button" class="btn btn-warning size-h-65 payment-btn" type="submit">
                buy
            </button>
        </div>
    </div>
</section>

</body>

<script type="text/javascript" th:inline="javascript">
    var clientKey = 'test_ck_DLJOpm5QrlxP14voEWerPNdxbWnY';
    var tossPayments = TossPayments(clientKey);
    var button = document.getElementById('payment_card_button');
    let amount = document.getElementById('amount').innerText;
    let orderId = document.getElementById('orderId').innerText;
    let orderName = document.getElementById('orderName').innerText;
    let customerName = document.getElementById('customerName').innerText;

    button.addEventListener('click', function () {
        tossPayments.requestPayment('카드', { // 결제 수단 파라미터
            amount: amount,
            orderId: orderId,
            orderName: orderName,
            customerName: customerName,
            successUrl: 'http://localhost:8080/security-login',
            failUrl: 'http://localhost:8080/fail',
        })
            .catch(function (error) {
                if (error.code === 'USER_CANCEL') {
                    // 결제 고객이 결제창을 닫았을 때 에러 처리
                } else if (error.code === 'INVALID_CARD_COMPANY') {
                    // 유효하지 않은 카드 코드에 대한 에러 처리
                }
            })
    });
</script>

</html>